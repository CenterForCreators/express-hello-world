<script type="module">
function wireClaim() {
  const btn = document.getElementById('claimBtn');
  if (!btn || btn.__wired) return;
  btn.__wired = true;

  btn.addEventListener('click', async (ev) => {
    ev.preventDefault();

    const statusEl = document.getElementById('claimStatus');
    const spinEl   = document.getElementById('claimSpin');

    if (statusEl) {
      statusEl.className = 'status warn';
      statusEl.textContent = 'Sending…';
    }
    if (spinEl) spinEl.style.display = 'inline-block';

    try {
      if (!window.connectedAccount) {
        if (statusEl) {
          statusEl.className = 'status err';
          statusEl.textContent = 'Connect Xaman first.';
        }
        return;
      }

      const url = CONFIG.FAUCET_ENDPOINT;
      const r = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          account: window.connectedAccount,
          captcha_ok: true
        })
      });

      const j = await r.json().catch(() => ({}));

      if (statusEl) {
        if (j.ok) {
          statusEl.className = 'status ok';
          statusEl.textContent = '✅ 10 CFC sent!';
        } else {
          statusEl.className = 'status err';
          statusEl.textContent = j.error || 'Claim failed';
        }
      }

    } catch (e) {
      console.error(e);
      if (statusEl) {
        statusEl.className = 'status err';
        statusEl.textContent = 'Network error';
      }
    } finally {
      if (spinEl) spinEl.style.display = 'none';
    }
  });
}
</script>
